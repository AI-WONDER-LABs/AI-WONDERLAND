= Audit Log Streaming
:page-platform: Cloud
:page-description: "This document explains how to stream CircleCI audit logs to an S3 bucket."
:experimental:

[#overview]
== Overview
The CircleCI Audit Log Streaming feature provides organizations with a solution for streaming audit logs directly to their own AWS S3 buckets. This enables organizations to maintain comprehensive security visibility, meet compliance requirements, and integrate CircleCI audit data with their existing security monitoring infrastructure.

[#prerequisites]
== Prerequisites

Before setting up audit log streaming, ensure you have the following:

* CircleCI Enterprise or Scale plan (not available to Free or Performance customers)
* AWS account with permissions to create and manage S3 buckets
* IAM role or user with appropriate S3 write permissions
* Network configuration to allow secure connections between CircleCI and AWS

[#set-up-aws-prerequisites]
=== Set up AWS prerequisites

. Create an S3 bucket in your AWS account to store the audit logs.
+
You can also specify an optional folder or prefix (for example, `my-bucket/audit-logs`).
+
Take note of the AWS region where you created the S3 bucket (for example,`us-east-1`).
. Create an IAM role that CircleCI can assume. This role requires two key policies:
.. Trust policy
+
This policy allows CircleCI's service to assume the role. The principal ARN in this policy is a template that you must configure with your specific AWS account and CircleCI organization IDs.
+
The complete template for the trust relationship is the following:
+
[source,json]
----
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Federated": "arn:aws:iam::<aws-account-id>:oidc-provider/oidc.circleci.com/org/<org-id>"
            },
            "Action": "sts:AssumeRoleWithWebIdentity",
            "Condition": {
                "StringEquals": {
                    "oidc.circleci.com/org/<org-id>:aud": "<org-id>"
                }
            }
        }
    ]
}
----
+
Replace `<aws-account-id>` with your 12-digit AWS account ID and `<org-id>` with your unique CircleCI organization ID (found on the menu:Organization Settings[Overview] page in the link:https://app.circleci.com/[CircleCI web app]).

.. Permissions policy
+
This policy grants the role permission to write objects to your S3 bucket (and any specified prefix).
+
The minimum required access policy for the role is as follows:
+
[source,json]
----
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::<bucket-name>/*",
                "arn:aws:s3:::<bucket-name>"
            ]
        }
    ]
}
----
+
Replace `<bucket-name>` with the name of your S3 bucket.

. Set up an OIDC identity provider to allow CircleCI's OIDC tokens to be used for authentication.
.. Navigate to the IAM Console in AWS.
.. In the left navigation menu, select *Identity Providers*.
.. Select *Add provider*.
.. Choose *OpenID Connect* as the provider type.
.. In the *Provider URL* field, specify `\https://oidc.circleci.com/org/<org-id>` (replace `<org-id>` with your CircleCI organization ID).
.. In the *Audience* field, enter your organization ID.


[#configure-audit-log-streaming]
== Configure Audit Log Streaming

. Navigate to menu:Organization Settings[Security].
. Scroll down to the **Audit Logs > Streaming audit logs** section and select btn:[Stream audit logs].
+
image::guides:ROOT:stream-audit-logs.png[Stream audit logs section]

. Confirm that you have completed the prerequisites by selecting btn:[Continue].
+
image::guides:ROOT:confirm-prerequisites.png[Confirm prerequisites completion]

. In the configuration dialog, specify the following fields:
.. **Region**: The AWS region where your S3 bucket is located.
.. **S3 Bucket Name**: The name of the S3 bucket where audit logs will be streamed.
.. **Role ARN**: The Amazon Resource Name (ARN) for the IAM role that CircleCI will use to access your S3 bucket.

. Select btn:[Connect CircleCI to AWS].
+
image::guides:ROOT:connect-circleci-aws.png[Connect CircleCI to AWS]

. When the connection to your S3 bucket is successfully validated, **Connected** with a green checkmark appears under **Status**.
+
image::guides:ROOT:s3bucket-connected.png[S3 Connection successful]


[#verification-and-testing]
== Verification and Testing

After setting up audit log streaming:

. Verify successful streaming by checking the **Last delivery** timestamp.
. Confirm logs are appearing in your designated S3 bucket.
. Test integrations with your SIEM or security monitoring tools.
. Set up appropriate alerts for connection failures or delivery interruptions.


[#managing-active-streams]
== Managing Active Streams

Once configured, you can view and manage audit log streams.

- Pause Streaming: Use the toggle switch under **Actions** to temporarily disable log streaming. **Status** will change to **Disabled**.
- Monitor Delivery: Check the **Last delivery** field to verify recent successful deliveries.
- Delete Configuration: Select the trash icon under **Actions** to remove the streaming setup. A popup warning will appear, select btn:[Delete] to confirm.
- Restart Streaming: Toggle the switch to resume paused streams.
+
image::guides:ROOT:audit-log-stream-actions.png[Audit log stream actions]


[#audit-event-coverage]
== Audit Event Coverage

All security-relevant events within CircleCI are captured and streamed, including:

- User Authentication Events: Logins, failed attempts, password changes
- Authorization Changes: Role assignments, permission updates
- Project Configuration: Modifications to project settings and configurations
- Pipeline Execution: Events related to pipeline runs and builds
- Secrets and Context: Modifications to sensitive data and execution contexts
- Organization Management: Team and organization-level administrative activities

[#limitations]
== Limitations

- Audit log streaming is only available to CircleCI Enterprise and Scale plan customers. Free and Performance plan customers do not have access to this feature.

- Currently, streaming is supported for a single S3 bucket per organization.

[#support-and-troubleshooting]
== Support and Troubleshooting

NOTE: xref:security:audit-logs[Manual audit log downloads] remain available as backup.

* **Configuration Issues**: Most problems are related to AWS IAM permissions or S3 bucket configuration.
* **Connection Failures**: If **Status** shows **Disconnected**, verify AWS credentials and permissions before contacting support. Use the toggle switch to restart streaming once issues are resolved.
* **Missing Logs**: Ensure that your S3 bucket policies allow write access from CircleCI's service accounts.