= CircleCI task agent CLI usage guide
:page-platform: Cloud, Server v4+
:page-description: Using the CircleCI task agent CLI in your CI/CD pipeline
:experimental:

This page provides reference documentation for the CircleCI task agent CLI. This CLI is different from the xref:local-cli.adoc[CircleCI local CLI] tool that you may already know. Understanding the difference between these two CLI interfaces is essential for effective usage during your build processes.

== CLI differentiation

The CircleCI Task Agent:: A specialized command-line interface. Task agent retrieves and configures a task before managing the execution of the job within a chosen compute environment. The Task agent CLI is available for use in your CI/CD pipelines.

The Local CLI:: The development tool used on a local machine. It handles day-to-day development tasks, testing, and local workflow management.

These tools share some similarities. However, they serve different purposes and operate in different contexts with different capabilities and permissions.

=== What you will find in this document

This reference guide covers some basic information about the CircleCI task-agent CLI, including:

* Complete command reference - available commands and subcommands.
* Flag documentation - Comprehensive flag options with descriptions.
* Usage examples - Practical examples showing real-world usage patterns.
* Command descriptions - Clear explanations of what each command does.

== Root command

* `circleci`: The CLI tool to be used in CircleCI.

== Subcommands

=== Task

Manage tasks. You can also use the alias `step` instead of `task`.

==== Halt

Halt the current task and treat it as successful.

*Example usage:*

.Equivalent commands to halt the current task and treat it as successful
[source,yaml]
----
## These commands would be equivalent:
circleci task halt
circleci step halt
----

=== Version

Output version information.

*Flags*

* `short`: print only the version string.

*Example usage:*

[source,yaml]
----
circleci version [flag]
----

=== Tests

Collect and split tests so they may be run in parallel.

==== Split

Group tests into independent buckets so they can be run in parallel.

*Flags*

[cols="2,3"]
|===
| Flag | Description

| `index`
| Index of node.

| `total`
| Number of nodes.

| `split-by`
| How to weight the split, allowed values are `name`, `filesize`, and `timings`.

| `timings-type`
| Lookup historical timing data by: `classname`, `filename`, `testname` or `autodetect`(automatically choose `classname` or `filename`) (default `autodetect`).

| `show-counts`
| Print test file or test class counts to stderr (default `false`).

| `time-default`
| Override default time value of test timing data when timing is not found (default 0s).

| `timings-file`
| JSON file containing historical timing data.
|===

==== Glob

Print files matching the glob pattern.

*Flags*

NOTE: The available flag for the `glob` subcommand is a pattern, and supports the
following symbols:

[cols="2,3"]
|===
| Symbol | Description

| `*`
| Matches any sequence of non-path-separators.

| `**`
| Matches any sequence of characters, including path separators.

| `?`
| Matches any single non-path-separator character.

| `[...]`
| Matches any character in the set. May use '-' for a range.

| `{...}`
| Matches a sequence of characters, if any of the alternatives in braces matches.
|===

==== Run

Split and run tests.

*Flags*

[cols="2,3"]
|===
| Flag | Description

| `command`
| Script that will be run for a list of tests.

| `index`
| Index of node.

| `total`
| Number of nodes.

| `split-by`
| How to weight the split, allowed values are `name`, `filesize`, and `timings`.

| `timings-type`
| Lookup historical timing data by: `classname`, `filename`, `testname` or `autodetect`(automatically choose classname or filename) (default `autodetect`).

| `show-counts`
| Print test file or test class counts to stderr (default `false`).
|===

*Example usage:*

[source,yaml]
----
version: 2.1

jobs:
  my-job:
    docker:
      - image: cimg/base:stable
    steps:
      - run:
          command: |
            ## example usage of split
            circleci tests split [flags] [FILENAME]
            ## example usage of glob
            circleci tests glob [flags] PATTERN
            ## example usage of run
            circleci tests run [flags]
----

*More information on using the `tests` command*:

* xref:optimize:parallelism-faster-jobs.adoc#how-test-splitting-works[Guide to Test splitting and parallelism]
* xref:optimize:use-the-circleci-cli-to-split-tests.adoc[Use the CircleCI CLI to split tests]

=== Environment variables

Use `env` to manage environment variables

==== Substitute

Substitute environment variables in a string

*Example usage:*

[source,yaml]
----
circleci env
----

#This example needs expanding to show it being used in a job, I don't understand enough to do this myself, and we don't seem to have this in the env vars docs anywhere#

=== Run

Invokes a task-agent subcommand by name.

==== OIDC

Run authentication using OIDC.

==== Release

#Need a description for all the release subcommands#

===== Plan

Plan and identify a new deployment that can be referenced to update its status later.

A _planned_ deployment will show in the Deploys UI with `pending` status.

*Flags*

[cols="2,3"]
|===
| Flag | Description

| `deploy-name`
| An arbitrary positional argument that will be used to identify the deployment. This should be unique within the workflow.

| `environment-name`
| Sets the target environment. If the specified environment does not exist, it will be created. If you do not specify an environment, CircleCI will create one named default.

| `component-name`
| Sets the name that will be displayed in the UI. If you do not already have a component in your project a new one will be created with the name of the project. This will be set as the component that is being deployed.

| `target-version`
| Should match the version being deployed.

| `namespace`
| Optional flag to use a namespace value other than default.
|===

===== Update

Update the status of the deployment.

*Flags*

[cols="2,3"]
|===
| Flag | Description

| `status`
| Update the deploy status (values can be `RUNNING`, `SUCCESS`, or `FAILED`).
|===

===== Log

#Need a description for the log subcommand#

*Flags*

* `environment-name`: sets the target environment. If the specified environment does not exist, it will be created. If you do not specify an environment, CircleCI will create one named default.
* `component-name`: sets the name that will be displayed in the UI.
* `target-version`: should match the version being deployed.
* `namespace`: optional flag to use a namespace value other than default.

*Example usage:*

#Need to show the example usage of the log subcommand and show them all in a job - full config#

[source,yaml]
----
circleci run oidc
circleci run release [command] [flags]
----

*More information on using  the `run` command*:

* xref:deploy:configure-deploy-markers.adoc#deploy-markers-with-status-updates[Configure deploy markers]

== Global flags

[cols="2,3"]
|===
| Flag | Description

| `verbose`
| Enable verbose logging output.
|===

== Help

Use the following for more information about a command.

[source]
----
circleci run [command] --help
----